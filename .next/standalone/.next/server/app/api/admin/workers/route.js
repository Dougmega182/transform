(()=>{var e={};e.id=163,e.ids=[163],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},88495:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>p,serverHooks:()=>g,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>d});var s=r(42706),i=r(28203),o=r(45994),a=r(39187),u=r(11587),c=r(98873),l=r(61222);async function d(e){try{let t=await (0,c.r)(e);if(!t||"CEO"!==t.role&&"ADMIN"!==t.role)return a.NextResponse.json({message:"Unauthorized"},{status:401});let r=(0,l.k)(new Date,{weekStartsOn:1}),n=(await u.z.user.findMany({where:{role:"USER"},include:{attendances:{include:{jobSite:!0}},inductions:!0,swmsSignoffs:!0}})).map(e=>{let t=e.attendances.find(e=>null===e.signOutTime),n=e.attendances.filter(e=>new Date(e.signInTime)>=r&&null!==e.signOutTime).reduce((e,t)=>{if(!t.signOutTime)return e;let r=new Date(t.signInTime).getTime(),n=new Date(t.signOutTime).getTime();return e+(n-r)/36e5},0);return{id:e.id,name:e.name||"Unknown",email:e.email,currentSite:t?t.jobSite.name:null,signInTime:t?t.signInTime.toISOString():null,totalHoursThisWeek:n,completedInductions:e.inductions.length,signedSwms:e.swmsSignoffs.length}});return a.NextResponse.json({workers:n})}catch(e){return console.error("Error fetching admin worker data:",e),a.NextResponse.json({message:"An error occurred while fetching worker data"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/workers/route",pathname:"/api/admin/workers",filename:"route",bundlePath:"app/api/admin/workers/route"},resolvedPagePath:"E:\\signonsite\\transform\\app\\api\\admin\\workers\\route.ts",nextConfigOutput:"standalone",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:w,serverHooks:g}=p;function f(){return(0,o.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:w})}},96487:()=>{},78335:()=>{},98873:(e,t,r)=>{"use strict";r.d(t,{r:()=>i});var n=r(43008),s=r(11587);async function i(e){try{let t=e.headers.get("cookie");if(!t)return null;let r=t.split(";").reduce((e,t)=>{let[r,n]=t.trim().split("=");return e[r]=decodeURIComponent(n),e},{})["auth-token"];if(!r)return null;let i=(0,n.verify)(r,process.env.JWT_SECRET||"fallback-secret");return await s.z.user.findUnique({where:{id:i.id},select:{id:!0,name:!0,email:!0,role:!0,company:!0,position:!0}})}catch(e){return console.error("Error getting user from request:",e),null}}},11587:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var n=r(96330);let s=global.prisma||new n.PrismaClient({log:["error"]})},38579:(e,t,r)=>{"use strict";r.d(t,{q:()=>s});let n={};function s(){return n}},91462:(e,t,r)=>{"use strict";r.d(t,{_P:()=>i,my:()=>n,w4:()=>s});let n=6048e5,s=864e5,i=Symbol.for("constructDateFrom")},79174:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});var n=r(91462);function s(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&n._P in e?e[n._P](t):e instanceof Date?new e.constructor(t):new Date(t)}},61222:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});var n=r(38579),s=r(87046);function i(e,t){let r=(0,n.q)(),i=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,o=(0,s.a)(e,t?.in),a=o.getDay();return o.setDate(o.getDate()-((a<i?7:0)+a-i)),o.setHours(0,0,0,0),o}},87046:(e,t,r)=>{"use strict";r.d(t,{a:()=>s});var n=r(79174);function s(e,t){return(0,n.w)(t||e,e)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,452,8],()=>r(88495));module.exports=n})();
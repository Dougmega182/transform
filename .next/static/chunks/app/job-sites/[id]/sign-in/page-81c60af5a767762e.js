(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{466:(e,t,s)=>{Promise.resolve().then(s.bind(s,8045))},8045:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var i=s(5155),r=s(2115),n=s(6046),a=s(1289),o=s(4085),d=s(5007),l=s(9134),c=s(7364),u=s(4836),h=s(3239),f=s(8173),m=s.n(f),x=s(208);function p(){let{user:e}=(0,a.A)(),t=(0,n.useRouter)(),s=(0,n.useParams)(),{toast:f}=(0,l.dj)(),[p,g]=(0,r.useState)(null),[v,j]=(0,r.useState)([]),[y,w]=(0,r.useState)([]),[S,N]=(0,r.useState)(null),[b,k]=(0,r.useState)(!0),[A,C]=(0,r.useState)(!1),[E,T]=(0,r.useState)(1);(0,r.useEffect)(()=>{let t=async()=>{try{let t=s.id,i=await fetch("/api/job-sites/".concat(t));if(!i.ok)throw Error("Failed to fetch job site");let r=await i.json();g(r.jobSite);let n=await fetch("/api/job-sites/".concat(t,"/inductions?userId=").concat(null==e?void 0:e.id));if(!n.ok)throw Error("Failed to fetch inductions");let a=await n.json();j(a.inductions);let o=await fetch("/api/job-sites/".concat(t,"/swms?userId=").concat(null==e?void 0:e.id));if(!o.ok)throw Error("Failed to fetch SWMS");let d=await o.json();w(d.swmsList)}catch(e){console.error("Error fetching data:",e),f({variant:"destructive",title:"Error",description:"Failed to load site data"})}finally{k(!1)}};s.id&&e&&t()},[s.id,e,f]);let M=async()=>{if(!S){f({variant:"destructive",title:"Signature required",description:"Please provide your signature to sign in"});return}C(!0);try{if(!(await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobSiteId:null==p?void 0:p.id,signature:S})})).ok)throw Error("Failed to sign in");f({title:"Signed in successfully",description:"You have been signed in to ".concat(null==p?void 0:p.name)}),t.push("/job-sites/".concat(null==p?void 0:p.id))}catch(e){console.error("Error signing in:",e),f({variant:"destructive",title:"Sign in failed",description:e instanceof Error?e.message:"An error occurred during sign in"})}finally{C(!1)}};if(b)return(0,i.jsx)("div",{className:"container flex h-[calc(100vh-4rem)] items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-lg font-medium",children:"Loading..."}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Please wait while we load site data"})]})});if(!p)return(0,i.jsx)("div",{className:"container py-10",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-lg font-medium",children:"Job site not found"}),(0,i.jsx)(o.$,{asChild:!0,className:"mt-4",children:(0,i.jsx)(m(),{href:"/job-sites",children:"Back to Job Sites"})})]})});let I=v.every(e=>e.completed),O=y.every(e=>e.signed);return(0,i.jsxs)("div",{className:"container py-10",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)(o.$,{variant:"ghost",asChild:!0,className:"mb-4",children:(0,i.jsxs)(m(),{href:"/job-sites/".concat(p.id),children:[(0,i.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Back to Site Details"]})}),(0,i.jsxs)("h1",{className:"text-3xl font-bold",children:["Sign In to ",p.name]}),(0,i.jsx)("p",{className:"text-muted-foreground",children:p.address})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[1===E&&(0,i.jsxs)(d.Zp,{children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:"Site Inductions"}),(0,i.jsx)(d.BT,{children:"Complete all required inductions before signing in"})]}),(0,i.jsx)(d.Wu,{children:0===v.length?(0,i.jsx)("p",{className:"text-center py-4",children:"No inductions required for this site"}):(0,i.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(u.A,{className:"h-5 w-5 mr-2 text-muted-foreground"}),(0,i.jsx)("div",{children:(0,i.jsx)("p",{className:"font-medium",children:e.title})})]}),(0,i.jsx)("div",{children:e.completed?(0,i.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,i.jsx)(h.A,{className:"h-5 w-5 mr-1"}),(0,i.jsx)("span",{children:"Completed"})]}):(0,i.jsx)(o.$,{size:"sm",onClick:()=>t.push("/inductions/".concat(e.id)),children:"Complete Induction"})})]},e.id))})}),(0,i.jsx)(d.wL,{children:(0,i.jsx)(o.$,{onClick:()=>T(2),disabled:!I,children:I?"Continue to SWMS":"Complete All Inductions to Continue"})})]}),2===E&&(0,i.jsxs)(d.Zp,{children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:"Safe Work Method Statements"}),(0,i.jsx)(d.BT,{children:"Review and sign all required SWMS before signing in"})]}),(0,i.jsx)(d.Wu,{children:0===y.length?(0,i.jsx)("p",{className:"text-center py-4",children:"No SWMS required for this site"}):(0,i.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(u.A,{className:"h-5 w-5 mr-2 text-muted-foreground"}),(0,i.jsx)("div",{children:(0,i.jsx)("p",{className:"font-medium",children:e.title})})]}),(0,i.jsx)("div",{children:e.signed?(0,i.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,i.jsx)(h.A,{className:"h-5 w-5 mr-1"}),(0,i.jsx)("span",{children:"Signed"})]}):(0,i.jsx)(o.$,{size:"sm",onClick:()=>t.push("/swms/".concat(e.id)),children:"Review & Sign"})})]},e.id))})}),(0,i.jsxs)(d.wL,{className:"flex justify-between",children:[(0,i.jsx)(o.$,{variant:"outline",onClick:()=>T(1),children:"Back to Inductions"}),(0,i.jsx)(o.$,{onClick:()=>T(3),disabled:!O,children:O?"Continue to Sign In":"Sign All SWMS to Continue"})]})]}),3===E&&(0,i.jsxs)(d.Zp,{children:[(0,i.jsxs)(d.aR,{children:[(0,i.jsx)(d.ZB,{children:"Sign In to Site"}),(0,i.jsx)(d.BT,{children:"Provide your signature to complete the sign-in process"})]}),(0,i.jsxs)(d.Wu,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,i.jsx)("h3",{className:"mb-4 text-lg font-medium",children:"Declaration"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"I confirm that I have completed all required inductions and reviewed all Safe Work Method Statements for this site. I understand and will comply with all safety requirements and procedures."})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"font-medium",children:"Signature"}),(0,i.jsx)("div",{className:"rounded-lg border p-4",children:(0,i.jsx)(x.A,{onSave:N})}),S&&(0,i.jsx)("p",{className:"text-sm text-green-600",children:"Signature captured successfully"})]})]}),(0,i.jsxs)(d.wL,{className:"flex justify-between",children:[(0,i.jsx)(o.$,{variant:"outline",onClick:()=>T(2),children:"Back to SWMS"}),(0,i.jsx)(o.$,{onClick:M,disabled:!S||A,children:A?"Signing In...":"Complete Sign In"})]})]})]})]})}},208:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(5155),r=s(2115),n=s(4085);let a=(0,s(7401).A)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);var o=s(7780),d=s(90);function l(e){let{onSave:t}=e,s=(0,r.useRef)(null),[l,c]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),f=(0,d.useMobile)();(0,r.useEffect)(()=>{let e=s.current;if(!e)return;let t=e.getContext("2d");if(!t)return;e.width=e.offsetWidth,e.height=200,t.lineWidth=2,t.lineCap="round",t.strokeStyle="#000",h(t);let i=()=>{if(!e||!t)return;let s=document.createElement("canvas"),i=s.getContext("2d");i&&(s.width=e.width,s.height=e.height,i.drawImage(e,0,0),e.width=e.offsetWidth,e.height=200,t.lineWidth=2,t.lineCap="round",t.strokeStyle="#000",t.drawImage(s,0,0))};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);let m=e=>{if(!u)return;c(!0),u.beginPath();let{offsetX:t,offsetY:s}=g(e);u.moveTo(t,s)},x=e=>{if(!l||!u)return;let{offsetX:t,offsetY:s}=g(e);u.lineTo(t,s),u.stroke()},p=()=>{u&&(c(!1),u.closePath())},g=e=>{let t,i;let r=s.current;if(!r)return{offsetX:0,offsetY:0};if(v(e)){let s=r.getBoundingClientRect(),n=e.touches[0]||e.changedTouches[0];t=n.clientX-s.left,i=n.clientY-s.top}else t=e.nativeEvent.offsetX,i=e.nativeEvent.offsetY;return{offsetX:t,offsetY:i}},v=e=>"touches"in e;return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"border rounded-md bg-white",children:(0,i.jsx)("canvas",{ref:s,className:"w-full touch-none cursor-crosshair",onMouseDown:m,onMouseMove:x,onMouseUp:p,onMouseLeave:p,onTouchStart:m,onTouchMove:x,onTouchEnd:p})}),(0,i.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,i.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{u&&s.current&&(u.clearRect(0,0,s.current.width,s.current.height),t(null))},children:[(0,i.jsx)(a,{className:"h-4 w-4 mr-2"})," Clear"]}),(0,i.jsxs)(n.$,{size:"sm",onClick:()=>{s.current&&t(s.current.toDataURL("image/png"))},children:[(0,i.jsx)(o.A,{className:"h-4 w-4 mr-2"})," Save Signature"]})]}),(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:f?"Use your finger to sign above":"Use your mouse to sign above"})]})}},4085:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var i=s(5155),r=s(2115),n=s(2317),a=s(1027),o=s(9602);let d=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=r.forwardRef((e,t)=>{let{className:s,variant:r,size:a,asChild:l=!1,...c}=e,u=l?n.DX:"button";return(0,i.jsx)(u,{className:(0,o.cn)(d({variant:r,size:a,className:s})),ref:t,...c})});l.displayName="Button"},5007:(e,t,s)=>{"use strict";s.d(t,{BT:()=>l,Wu:()=>c,ZB:()=>d,Zp:()=>a,aR:()=>o,wL:()=>u});var i=s(5155),r=s(2115),n=s(9602);let a=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});a.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});o.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});l.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});u.displayName="CardFooter"},9134:(e,t,s)=>{"use strict";s.d(t,{dj:()=>h});var i=s(2115);let r=0,n=new Map,a=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?a(s):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function c(e){l=o(l,e),d.forEach(e=>{e(l)})}function u(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||i()}}}),{id:s,dismiss:i,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function h(){let[e,t]=i.useState(l);return i.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},90:(e,t,s)=>{"use strict";s.d(t,{a:()=>r});var i=s(2115);function r(){let[e,t]=i.useState(void 0);return i.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)},[]),!!e}},1795:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>d,c:()=>o});var i=s(5155),r=s(2115),n=s(6046),a=s(9134);let o=(0,r.createContext)({user:null,loading:!0,signIn:async()=>{},signUp:async()=>{},signOut:()=>{}});function d(e){let{children:t}=e,[s,d]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),u=(0,n.useRouter)(),{toast:h}=(0,a.dj)();(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&d(t.user)}}catch(e){console.error("Authentication error:",e)}finally{c(!1)}})()},[]);let f=async(e,t)=>{try{c(!0);let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to sign in")}let i=await s.json();d(i.user),h({title:"Signed in successfully",description:"Welcome back, ".concat(i.user.name,"!")}),u.push("/dashboard")}catch(e){console.error("Sign in error:",e),h({variant:"destructive",title:"Sign in failed",description:e instanceof Error?e.message:"Please check your credentials and try again."})}finally{c(!1)}},m=async(e,t,s,i,r)=>{try{c(!0);let n=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:s,company:i,position:r})});if(!n.ok){let e=await n.json();throw Error(e.message||"Failed to sign up")}let a=await n.json();d(a.user),h({title:"Account created successfully",description:"Welcome, ".concat(e,"!")}),u.push("/dashboard")}catch(e){console.error("Sign up error:",e),h({variant:"destructive",title:"Sign up failed",description:e instanceof Error?e.message:"Please try again with different credentials."})}finally{c(!1)}},x=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),d(null),u.push("/"),h({title:"Signed out successfully"})}catch(e){console.error("Sign out error:",e)}};return(0,i.jsx)(o.Provider,{value:{user:s,loading:l,signIn:f,signUp:m,signOut:x},children:t})}},1289:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var i=s(2115),r=s(1795);function n(){let e=(0,i.useContext)(r.c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9602:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var i=s(3463),r=s(9795);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,i.$)(t))}},7364:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(7401).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},3239:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(7401).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4836:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(7401).A)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},7780:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});let i=(0,s(7401).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[882,173,441,517,358],()=>t(466)),_N_E=e.O()}]);